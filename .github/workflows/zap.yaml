name: ZAP Scan
run-name: ${{ github.actor }} is performing a DAST scan using ZAP ðŸš€
on: [push]

# on:
#   pull_request:
#     branches:
#       - main  # Change this if your default branch is different
# jobs:
#   zap-scan-job:
#     runs-on: ubuntu-latest
#     steps:
#       - name: Check out repository code
#         uses: actions/checkout@v4
        
jobs:
  zap_scan:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install dependencies
        run: pip install -r requirements.txt

      - name: Download and Install ZAP
        run: |
          wget https://github.com/zaproxy/zaproxy/releases/download/v2.16.0/ZAP_2.16.0_Linux.tar.gz
          tar -xzf ZAP_2.16.0_Linux.tar.gz
          chmod +x ZAP_2.16.0/zap.sh
        shell: bash

      # - name: debug
      #   run: pwd

      # - name: debug
      #   run: ls /home/arpit/Downloads/ZAP_2.16.0_Crossplatform/

      - name: Terminate existing ZAP server (if any)
        run: pkill -f zap


      # - name: Load environment variables
      #   run: |
      #     if [ -f .env ]; then
      #       export $(grep -v '^#' .env | xargs)
      #     fi
      #   shell: bash

      - name: Run ZAP Security Scan
        run: python3 basic-scan.py
      #   env:
      #     ZAP_API_KEY: ${{ secrets.ZAP_API_KEY }}
      #     ZAP_PATH: ${{ secrets.ZAP_PATH }}
      #     ZAP_PORT: ${{ secrets.ZAP_PORT }}
      #     TARGET_URL: ${{ secrets.TARGET_URL }}
      #     OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
